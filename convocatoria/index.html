<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Red de Apoyo Interinstitucional</title>
<style>
body { font-family: Arial, sans-serif; margin:30px; background:#f7f7f7; }

.header {
  background-color: #4b0082;
  color:white;
  padding:15px 20px;
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  justify-content:space-between;
  text-align:center;
}

.header-title h1 { font-size:1.5em; margin:0; font-weight:bold; }

.header img { max-height:50px; height:auto; width:auto; }

form { background:#fff; padding:20px; border:1px solid #ccc; margin-bottom:20px; }
form label { display:block; margin-top:10px; font-weight:bold; }
form input, form select, form textarea { width:100%; padding:8px; margin-top:5px; }
form button { margin-top:15px; padding:10px 15px; background:#4b0082; color:white; border:none; cursor:pointer; }

table { width:100%; border-collapse:collapse; background:white; }
th, td { border:1px solid #ccc; padding:10px; text-align:left; }
th { background:#eee; }
.delete-btn { background:red; color:white; border:none; padding:5px 10px; cursor:pointer; }

.search-container input { padding:8px; width:100%; margin-bottom:15px; }

.intro { background:#fff; padding:15px; border-left:5px solid #4b0082; margin-bottom:20px; }

@media(max-width:768px){
  .header { flex-direction:column; align-items:center; }
  .header-title h1 { font-size:1.2em; }
  .header img { max-height:50px; }
}
</style>
</head>
<body>

<header class="header">
  <div class="logos-left">
    <img src="logo.png" alt="UNAD" class="logo-unad">
    <img src="sue.png" alt="SUE" class="logo-sue">
  </div>
  <div class="header-title">
    <h1>Red de Apoyo Interinstitucional - Portal de Oportunidades</h1>
  </div>
  <div class="logos-right">
    <img src="sura.png" alt="Surcolombiana">
    <img src="tolima.png" alt="Tolima">
    <img src="uptc.png" alt="UPTC">
  </div>
</header>

<section class="intro">
  <p>Bienvenido a la Red de Apoyo Interinstitucional, un espacio para acceder a oportunidades de financiamiento y cooperación institucional. Explora, postula y haz parte de una red comprometida con investigación e innovación.</p>
</section>

<div id="adminLogin" style="margin-bottom:20px; background:#fff; padding:10px; border:1px solid #ccc;">
  <label>Modo administrador:</label>
  <input type="password" id="adminPassword" placeholder="Contraseña de administrador">
  <button onclick="loginAdmin()">Ingresar</button>
</div>

<form id="convocatoriaForm">
  <label>Nombre de la institución u organización</label>
  <input type="text" id="institucion" required>
  <label>Título de la oportunidad</label>
  <input type="text" id="titulo" required>
  <label>Enlace o contacto</label>
  <input type="text" id="enlace">
  <label>Tipo de convocatoria</label>
  <select id="tipo">
    <option>Cooperación internacional</option>
    <option>Cofinanciación</option>
    <option>Sistema de regalías</option>
    <option>Servicios Técnicos</option>
    <option>Sector productivo</option>
    <option>Otra</option>
  </select>
  <label>Descripción breve (fechas y documentación)</label>
  <textarea id="descripcion" rows="4"></textarea>
  <button type="submit">Registrar Convocatoria</button>
</form>

<div class="search-container">
  <input type="text" id="searchInput" placeholder="Buscar por institución, título o tipo...">
</div>

<table id="convocatoriaTable">
  <thead>
    <tr><th>Institución</th><th>Título</th><th>Enlace</th><th>Tipo</th><th>Descripción</th><th>Acciones</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwZYsZBzJlOyes8EFwFqt8pkIgJI9k4zvOFhHjyCMg6_F6Uh2XfleCKX5BD5A73McPB/exec"; // Cambiar por tu URL /exec de Apps Script

let convocatorias = [];
let isAdmin = false;
const adminPass = "admin2025";

function loginAdmin(){
  const input=document.getElementById("adminPassword").value.trim();
  if(input===adminPass){ isAdmin=true; alert("Modo administrador activado."); renderTable(convocatorias); }
  else alert("Contraseña incorrecta.");
}

async function loadData(){
  try{
    const res=await fetch(WEB_APP_URL);
    convocatorias=await res.json();
    renderTable(convocatorias);
  }catch(err){ console.error("Error cargando datos:",err); }
}

function renderTable(data){
  const tbody=document.querySelector("#convocatoriaTable tbody");
  tbody.innerHTML="";
  data.forEach(item=>{
    const row=document.createElement("tr");
    row.innerHTML=`
      <td>${item.institucion}</td>
      <td>${item.titulo}</td>
      <td>${item.enlace ? `<a href="${item.enlace}" target="_blank">Enlace</a>` : ""}</td>
      <td>${item.tipo}</td>
      <td>${item.descripcion}</td>
      <td>${isAdmin ? `<button class="delete-btn" data-id="${item.id}">Eliminar</button>` : ""}</td>
    `;
    tbody.appendChild(row);
  });

  if(isAdmin){
    document.querySelectorAll(".delete-btn").forEach(btn=>{
      btn.addEventListener("click",()=>deleteEntry(btn.dataset.id));
    });
  }
}

async function deleteEntry(id){
  if(!confirm("¿Eliminar esta convocatoria?")) return;
  try{
    const res=await fetch(WEB_APP_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"delete",id})});
    const r=await res.json();
    if(r.result==="success") loadData();
    else alert("Error al eliminar: "+r.message);
  }catch(err){ console.error(err); }
}

document.getElementById("convocatoriaForm").addEventListener("submit",async e=>{
  e.preventDefault();
  const nuevaConvocatoria={
    institucion: document.getElementById("institucion").value.trim(),
    titulo: document.getElementById("titulo").value.trim(),
    enlace: document.getElementById("enlace").value.trim(),
    tipo: document.getElementById("tipo").value.trim(),
    descripcion: document.getElementById("descripcion").value.trim()
  };
  try{
    const res=await fetch(WEB_APP_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(nuevaConvocatoria)
    });
    const r=await res.json();
    if(r.result==="success"){
      alert("Convocatoria registrada!");
      document.getElementById("convocatoriaForm").reset();
      loadData();
    }else alert("Error: "+r.message);
  }catch(err){ console.error(err); alert("No se pudo conectar con Google Sheets"); }
});

document.getElementById("searchInput").addEventListener("input",function(){
  const v=this.value.toLowerCase();
  renderTable(convocatorias.filter(c=>
    c.institucion.toLowerCase().includes(v) ||
    c.titulo.toLowerCase().includes(v) ||
    c.tipo.toLowerCase().includes(v)
  ));
});

loadData();
</script>

</body>
</html>













